\section{Introduction}\label{sec:intro}

Population health research is becoming increasingly based on data-driven methods
(as opposed to those designed solely by clinical experts) for patient-centred
care through the advent of accessible software and a relative abundance of
electronic data. A vital part of such research is to better understand the
healthcare needs and behaviours of a population, and it can be beneficial to
find an appropriate segmentation of that population; such a segmentation allows
for finer-grained analysis of groups in the population that share some form of
homogeneity. One commonly used method for such patient-centred analysis is that
of patient flow and their interaction with the healthcare system.

However, this process relies heavily on detailed data --- about both the system
and the population within that system --- which may limit research where
sophisticated data pipelines are not yet in place. This work demonstrates how
this issue may be overcome using administrative, spell-level hospital data to
build a patient clustering that feeds into a multi-class queuing model.
Specifically, this work examines patient records from the NHS Wales Cwm Taf
Morgannwg University Health Board (UHB) that present chronic obstructive
pulmonary disease (COPD). COPD is of particular interest to Cwm Taf Morgannwg
UHB as the condition is known to often present as a comorbidity in
patients~\cite{Houben2019} and it was found that they had the highest prevalence
of the condition across all the Welsh health boards in an internal report by NHS
Wales.

% TODO No reference for graph sent by Kendal but is this alright?

% TODO Image of process: administrative data -> extract service parameters ->
%                        validate parameters with Wasserstein distance ->
%                        continue with queuing model as normal

\subsection{Literature review}\label{subsec:review}

Given the subject matter of this work, the relevant literature spans much of
operational research in healthcare and the focus of this review is on the
principal topics of segmentation analysis, queuing models applied to hospital
systems, and the handling of missing or incomplete data for such queues.

\subsubsection{Segmentation analysis}

Segmentation analysis allows for the targeted analysis of otherwise
heterogeneous datasets and encompasses several techniques from operational
research, statistics and machine learning. One of the most desirable qualities
of this kind of analysis is the ability to glean and communicate simplified
summaries of patient needs to stakeholders within a healthcare
system~\cite{Vuik2016b, Yoon2020}. For instance, clinical profiling often
forms part of the wider analysis where each segment can be summarised in a
phrase or infographic~\cite{Vuik2016a, Yan2019}.

The review for this work identified three commonplace groups of patient
characteristics used to segment a patient population: their system
utilisation metrics, their clinical attributes and their pathway. The latter
is not used to segment the patients directly but rather groups their movements
through a healthcare system. This is typically done via process
mining.~\cite{Arnolds2018}~and~\cite{Delias2015} demonstrate how this technique
can be used to improve the efficiency of a hospital system as opposed to
tackling the more relevant issue of patient-centred care. The remaining
characteristics can be segmented with a number of techniques but recent works
tend to use unsupervised methods, typically latent class analysis (LCA) or
clustering~\cite{Yan2018}.

LCA is a statistical, model-based method used to identify groups (called latent
classes) in data by relating its observations to some unobserved (latent),
categorical attribute. This attribute has multiple categories, each
corresponding to a latent class. The discovered relations are then used to
separate the observations into latent classes according to their maximum
likelihood class membership~\cite{Hagenaars2002,Lazarsfeld1968}. This method has
proved useful in the study of comorbidity patterns as
in~\cite{Larsen2017,Kuwornu2014} where combinations of demographic and clinical
attributes are related to various subgroups of chronic diseases.

Similarly to LCA, clustering identifies groups (clusters) in data to produce a
labelling of its instances. However, clustering includes a wide variety of
methods where the common theme is to maximise homogeneity within, and
heterogeneity between, each cluster~\cite{Everitt2011}. The \(k\)-means paradigm
is the most popular form of clustering in literature. The method iteratively
partitions numerical data into \(k \in \mathbb{N}\) distinct parts where \(k\)
is fixed a priori. This method has proved popular as it is easily scalable and
its implementations are concise~\cite{Olafsson2008,Wu2009}. In addition to
\(k\)-means, hierarchical clustering methods can be effective if a suitable
number of parts cannot be found initially~\cite{Vuik2016a}. Although, supervised
hierarchical segmentation methods such as classification and regression trees
(as in~\cite{Harper2006}) have been used where an existing, well-defined label
is of particular significance.

\subsubsection{Queuing models}

These are the principal queuing theory works by
Erlang~\cite{Erlang1917,Erlang1920}. Deadlock is an aspect of applied queuing
theory of interest in recent literature~\cite{Palmer2018}. The software used is
Ciw~\cite{Palmer2019}.

\subsubsection{Handling incomplete queue data}

It is often the case that in practical situations where suitable data is not
(immediately) available, further inquiry will stop in that particular line of
research. Queuing models in healthcare settings appear to be such a
case.~\cite{Asanjarani2017} is a bibliographic work that collates articles on
the estimation of queuing system characteristics --- including their parameters.
Despite its breadth of almost 300 publications, only two articles have been
identified as being applied to healthcare:~\cite{Mohammadi2012,Yom2014}.  Both
works are concerned with customers that can re-enter services during their time
in the queuing system. This is particularly of value when considering the effect
of unpredictable behaviour in intensive care units, for
instance.~\cite{Mohammadi2012} seeks to approximate service and re-service
densities through a Bayesian approach and by separating out those customers
seeking to be serviced again. On the other hand,~\cite{Yom2014} considers an
extension to the \(M/M/c\) queue with direct re-entries. The devised model is
then used to determine resource requirements in a mass casualty event.

Aside from healthcare-specific works, the approximation of
queue parameters has formed a part of relevant modern queuing research. However,
the scope is largely focused on theoretic approximations rather than by
simulation.~\cite{Djabali2018,Goldenshluger2016} are two such recent
works that consider an underlying process to estimate a general service time
distribution in single server and infinite server queues respectively.

\subsection{Overview of the dataset and its clustering}\label{subsec:overview}

The dataset used in this work was provided by the Cwm Taf Morgannwg UHB as part
of an ongoing research project with the authors. The dataset contains a
spell-level summary of \input{tex/npatients}patients presenting COPD from
\input{tex/min_date}through \input{tex/max_date}totalling
\input{tex/nspells}spells. 

\begin{table}
    \centering
    \resizebox{\textwidth}{!}{%
        \input{tex/summary.tex}
    }\caption{A summary of patient-level clinical attributes and disease
    prevalence by cluster and by population}\label{tab:summary}
\end{table}

\begin{figure}
    \centering
    \begin{subfigure}{\halfimgwidth}
        \includegraphics[width=\linewidth]{cluster_los}
        \caption{}\label{fig:cluster_los}
    \end{subfigure}\hfill%
    \begin{subfigure}{\halfimgwidth}
        \includegraphics[width=\linewidth]{intervention_los}
        \caption{}\label{fig:intervention_los}
    \end{subfigure}
    \caption{%
        Kernel density estimate plots for length of stay by
        (\subref{fig:cluster_los}) cluster and (\subref{fig:intervention_los})
        intervention
    }\label{fig:los_kde}
\end{figure}

\begin{figure}
    \centering
    \begin{subfigure}{\halfimgwidth}
        \includegraphics[width=\linewidth]{cluster_ltcs}
        \caption{}\label{fig:cluster_ltcs}
    \end{subfigure}\hfill%
    \begin{subfigure}{\halfimgwidth}
        \includegraphics[width=\linewidth]{intervention_ltcs}
        \caption{}\label{fig:intervention_ltcs}
    \end{subfigure}
    \caption{%
        Proportions of concurrent LTC counts presented by patients by
        (\subref{fig:cluster_ltcs}) cluster and (\subref{fig:intervention_ltcs})
        intervention
    }\label{fig:ltcs}
\end{figure}

\begin{figure}
    \centering
    \begin{subfigure}{\halfimgwidth}
        \includegraphics[width=\linewidth]{cluster_spell_cost}
        \caption{}\label{fig:cluster_spell_cost}
    \end{subfigure}\hfill%
    \begin{subfigure}{\halfimgwidth}
        \includegraphics[width=\linewidth]{intervention_spell_cost}
        \caption{}\label{fig:intervention_spell_cost}
    \end{subfigure}
    \caption{%
        Histograms for spell costs by (\subref{fig:cluster_spell_cost}) cluster
        and (\subref{fig:intervention_spell_cost}) intervention
    }\label{fig:wimd_hist}
\end{figure}

\begin{figure}
    \centering
    \begin{subfigure}{\halfimgwidth}
        \includegraphics[width=\linewidth]{cluster_n_icds}
        \caption{}\label{fig:cluster_n_icds}
    \end{subfigure}\hfill%
    \begin{subfigure}{\halfimgwidth}
        \includegraphics[width=\linewidth]{intervention_n_icds}
        \caption{}\label{fig:intervention_n_icds}
    \end{subfigure}
    \caption{%
        Histograms for number of ICDs by (\subref{fig:cluster_n_icds}) cluster
        and (\subref{fig:intervention_n_icds}) intervention
    }\label{fig:n_icds_hist}
\end{figure}

\begin{figure}
    \centering
    \begin{subfigure}{\halfimgwidth}
        \includegraphics[width=\linewidth]{cluster_charlson_gross}
        \caption{}\label{fig:cluster_charlson}
    \end{subfigure}\hfill%
    \begin{subfigure}{\halfimgwidth}
        \includegraphics[width=\linewidth]{intervention_charlson_gross}
        \caption{}\label{fig:intervention_charlson}
    \end{subfigure}
    \caption{%
        Histograms for CCI by (\subref{fig:cluster_charlson}) cluster and
        (\subref{fig:intervention_charlson}) intervention
    }\label{fig:charlson_hist}
\end{figure}


% TODO Condensed analysis of clustering
%       - choosing k and a clustering algorithm
%       - comparison with treatment segmentation
